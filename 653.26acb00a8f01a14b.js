"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[653],{2653(O,b,i){i.d(b,{OtpVerificationPage:()=>M});var l=i(467),s=i(375),S=i(5984),m=i(7558),h=i(1600),y=i(5689),T=i(5902),p=i(8018),I=i(3979),c=i(5083),d=i(963);const g=(0,c.F3)("Sim",{});var e=i(5547);let M=(()=>{var v;class f{constructor(){this.apiSrc=(0,s.WQX)(y.z),this.navSrc=(0,s.WQX)(h.d),this.cacheSrc=(0,s.WQX)(h.H),this.location=(0,s.WQX)(S.aZ),this.alertSrc=(0,s.WQX)(T.n),this.translate=(0,s.WQX)(p.c$),this.currentOTP=null,this.resendOtp=()=>this.ionViewDidEnter(),this.mobile=this.location.getState(),this.notificationListener=d.W.addListener("localNotificationReceived",t=>{this.otp=String(t.extra?.res||""),setTimeout(()=>{this.verify()},3e3)})}ngOnDestroy(){var t=this;return(0,l.A)(function*(){t.notificationListener&&(t.notificationListener.remove(),t.notificationListener=null),yield d.W.removeAllListeners()})()}ionViewDidEnter(){var t=this;return(0,l.A)(function*(){let n=!1;t.mobile=t.location.getState();const a=yield d.W.requestPermissions();if(c.Ii.isNativePlatform()){if(g)var r=yield g.getSimCards();if(r)for(const o of r.simCards)n=o.number.includes(t.mobile.mobileNo)}var o;t.apiSrc.put("farmer/sendotp",null,{mobileno:t.mobile.mobileNo}).subscribe({next:(o=(0,l.A)(function*(u){t.currentOTP=u,n?"denied"==a.display?t.getSMS():yield d.W.schedule({notifications:[{title:"BHUMATA-MITRA",body:`${u} is your OTP.Valid for 10 minutes. Do not share this code with anyone else`,id:1,schedule:{at:new Date(Date.now()+1e3)},sound:"beep.wav",channelId:"otp_channel",ongoing:!1,actionTypeId:"",extra:{res:u}}]}):t.getSMS()}),function(P){return o.apply(this,arguments)}),error:o=>{t.alertSrc.alert(o.message)}})})()}getSMS(){var t=this;return(0,l.A)(function*(){let n;n=c.Ii.getPlatform()?"https://api.mylogin.co.in/api/v2/SendSMS":"/api/v2/SendSMS";const a={ApiKey:"M2+DOT4eTDnFhiyg7bqL039BbvX89ot4+pK8tuQy9kQ=",ClientId:"4d708aa1-a1be-4d9c-b401-faae8fd772e1",SenderId:"GHTFPL",Message:`${t.currentOTP} is your verification code. For your security, do not share this code. Expires in 5 minutes Ghatprabha Fertilizer Pvt. Ltd.`,MobileNumbers:`91${t.mobile.mobileNo}`,Is_Flash:"false"},r=yield c.pX.get({url:n,params:a});0==r.data.Data[0].MessageErrorCode?console.log(r.data):t.alertSrc.alert(r.data.Data[0].MessageErrorDescription)})()}verify(){var t=this;return(0,l.A)(function*(){if(t.currentOTP==t.otp){if(!t.mobile.registered)return 1==Object.keys(t.mobile).length?t.cacheSrc.set("farmerInfo",{mobile:t.mobile.mobileNo}):t.cacheSrc.set("farmerInfo",{...t.mobile}),void t.navSrc.navigate("address",null,"forward");t.cacheSrc.set("farmerInfo",{...t.mobile}),t.navSrc.navRoot("dashboard",null,"forward")}else t.alertSrc.alert(t.translate.instant("Incorrect OTP"))})()}static#e=v=()=>(this.\u0275fac=function(n){return new(n||f)},this.\u0275cmp=e.VBU({type:f,selectors:[["app-otp-verification"]],decls:15,vars:14,consts:[[1,"flex","flex-col","items-center","justify-center","min-h-screen","gap-10","ion-padding"],[1,"w-full","max-w-md","mx-auto","text-center"],[1,"text-2xl","font-semibold","text-green-600"],[1,"text-gray-600","mt-4","text-base","leading-relaxed","px-4"],["name","OTP","type","number","length","4","size","large","shape","round",1,"otpcls","font-bold","text-lg",3,"ngModelChange","ngModel"],[1,"w-full","py-3","mt-8","font-semibold","rounded-lg","bg-green-600","text-white","shadow-md","active:scale-95","transition","disabled:bg-green-300",3,"click","disabled"],[1,"text-blue-600","text-sm","mt-3","underline",3,"click"]],template:function(n,a){1&n&&(e.j41(0,"div",0)(1,"div",1)(2,"h1",2),e.EFF(3),e.nI1(4,"translate"),e.k0s(),e.j41(5,"p",3),e.EFF(6),e.nI1(7,"translate"),e.k0s(),e.j41(8,"ion-input-otp",4),e.mxI("ngModelChange",function(o){return e.DH7(a.otp,o)||(a.otp=o),o}),e.k0s(),e.j41(9,"button",5),e.bIt("click",function(){return a.verify()}),e.EFF(10),e.nI1(11,"translate"),e.k0s(),e.j41(12,"p",6),e.bIt("click",function(){return a.resendOtp()}),e.EFF(13),e.nI1(14,"translate"),e.k0s()()()),2&n&&(e.R7$(3),e.SpI(" ",e.bMT(4,6,"Submit OTP")," "),e.R7$(3),e.SpI(" ",e.bMT(7,8,"We have sent an OTP to your registered mobile number.Enter it to continue.")," "),e.R7$(2),e.R50("ngModel",a.otp),e.R7$(),e.Y8G("disabled",!a.otp),e.R7$(),e.SpI(" ",e.bMT(11,10,"Verify")," "),e.R7$(3),e.SpI(" ",e.bMT(14,12,"Resend OTP")," "))},dependencies:[p.h,I.UR,m.YN,m.BC,m.vS,p.D9],encapsulation:2}))}return v(),f})()}}]);