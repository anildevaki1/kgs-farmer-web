"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[653],{2653(M,v,n){n.d(v,{OtpVerificationPage:()=>I});var l=n(467),s=n(375),b=n(5984),u=n(7558),h=n(1600),S=n(5689),y=n(5902),m=n(8018),T=n(3979),c=n(5083),d=n(963);const p=(0,c.F3)("Sim",{});var e=n(5547);let I=(()=>{var g;class f{constructor(){this.apiSrc=(0,s.WQX)(S.z),this.navSrc=(0,s.WQX)(h.d),this.cacheSrc=(0,s.WQX)(h.H),this.location=(0,s.WQX)(b.aZ),this.alertSrc=(0,s.WQX)(y.n),this.translate=(0,s.WQX)(m.c$),this.currentOTP=null,this.resendOtp=()=>this.ionViewDidEnter(),this.mobile=this.location.getState(),this.notificationListener=d.W.addListener("localNotificationReceived",t=>{this.otp=String(t.extra?.res||""),setTimeout(()=>{this.verify()},3e3)})}ngOnDestroy(){var t=this;return(0,l.A)(function*(){t.notificationListener&&(t.notificationListener.remove(),t.notificationListener=null),yield d.W.removeAllListeners()})()}ionViewDidEnter(){var t=this;return(0,l.A)(function*(){let a=!1;t.mobile=t.location.getState();const r=yield d.W.requestPermissions();if(c.Ii.isNativePlatform()){let i=null;if(p&&(i=yield p.getSimCards()),i&&i.simCards&&0!==i.simCards.length)for(const o of i.simCards)a=o.number.includes(t.mobile.mobileNo);else t.getSMS()}var i;t.apiSrc.put("farmer/sendotp",null,{mobileno:t.mobile.mobileNo}).subscribe({next:(i=(0,l.A)(function*(o){t.currentOTP=o,a?"denied"==r.display?t.getSMS():yield d.W.schedule({notifications:[{title:"BHUMATA-MITRA",body:`${o} is your OTP.Valid for 10 minutes. Do not share this code with anyone else`,id:1,schedule:{at:new Date(Date.now()+1e3)},sound:"beep.wav",channelId:"otp_channel",ongoing:!1,actionTypeId:"",extra:{res:o}}]}):t.getSMS()}),function(O){return i.apply(this,arguments)}),error:i=>{t.alertSrc.alert(i.message)}})})()}getSMS(){var t=this;return(0,l.A)(function*(){let a;a=c.Ii.getPlatform()?"https://api.mylogin.co.in/api/v2/SendSMS":"/api/v2/SendSMS";const r={ApiKey:"M2+DOT4eTDnFhiyg7bqL039BbvX89ot4+pK8tuQy9kQ=",ClientId:"4d708aa1-a1be-4d9c-b401-faae8fd772e1",SenderId:"GHTFPL",Message:`${t.currentOTP} is your verification code. For your security, do not share this code. Expires in 5 minutes Ghatprabha Fertilizer Pvt. Ltd.`,MobileNumbers:`91${t.mobile.mobileNo}`,Is_Flash:"false"},i=yield c.pX.get({url:a,params:r});0==i.data.Data[0].MessageErrorCode?console.log(i.data):t.alertSrc.alert(i.data.Data[0].MessageErrorDescription)})()}verify(){var t=this;return(0,l.A)(function*(){if(t.currentOTP==t.otp){if(!t.mobile.registered)return 1==Object.keys(t.mobile).length?t.cacheSrc.set("farmerInfo",{mobile:t.mobile.mobileNo}):t.cacheSrc.set("farmerInfo",{...t.mobile}),void t.navSrc.navigate("address",null,"forward");t.cacheSrc.set("farmerInfo",{...t.mobile}),t.navSrc.navRoot("dashboard",null,"forward")}else t.alertSrc.alert(t.translate.instant("Incorrect OTP"))})()}static#e=g=()=>(this.\u0275fac=function(a){return new(a||f)},this.\u0275cmp=e.VBU({type:f,selectors:[["app-otp-verification"]],decls:15,vars:14,consts:[[1,"flex","flex-col","items-center","justify-center","min-h-screen","gap-10","ion-padding"],[1,"w-full","max-w-md","mx-auto","text-center"],[1,"text-2xl","font-semibold","text-green-600"],[1,"text-gray-600","mt-4","text-base","leading-relaxed","px-4"],["name","OTP","type","number","length","4","size","large","shape","round",1,"otpcls","font-bold","text-lg",3,"ngModelChange","ngModel"],[1,"w-full","py-3","mt-8","font-semibold","rounded-lg","bg-green-600","text-white","shadow-md","active:scale-95","transition","disabled:bg-green-300",3,"click","disabled"],[1,"text-blue-600","text-sm","mt-3","underline",3,"click"]],template:function(a,r){1&a&&(e.j41(0,"div",0)(1,"div",1)(2,"h1",2),e.EFF(3),e.nI1(4,"translate"),e.k0s(),e.j41(5,"p",3),e.EFF(6),e.nI1(7,"translate"),e.k0s(),e.j41(8,"ion-input-otp",4),e.mxI("ngModelChange",function(o){return e.DH7(r.otp,o)||(r.otp=o),o}),e.k0s(),e.j41(9,"button",5),e.bIt("click",function(){return r.verify()}),e.EFF(10),e.nI1(11,"translate"),e.k0s(),e.j41(12,"p",6),e.bIt("click",function(){return r.resendOtp()}),e.EFF(13),e.nI1(14,"translate"),e.k0s()()()),2&a&&(e.R7$(3),e.SpI(" ",e.bMT(4,6,"Submit OTP")," "),e.R7$(3),e.SpI(" ",e.bMT(7,8,"We have sent an OTP to your registered mobile number.Enter it to continue.")," "),e.R7$(2),e.R50("ngModel",r.otp),e.R7$(),e.Y8G("disabled",!r.otp),e.R7$(),e.SpI(" ",e.bMT(11,10,"Verify")," "),e.R7$(3),e.SpI(" ",e.bMT(14,12,"Resend OTP")," "))},dependencies:[m.h,T.UR,u.YN,u.BC,u.vS,m.D9],encapsulation:2}))}return g(),f})()}}]);